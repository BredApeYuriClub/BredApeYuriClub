<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketplace NFT</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.0.24/dist/ethers.umd.min.js"></script>
</head>
<body>
    <h1>Welcome to NFT Marketplace</h1>

    <button id="connectButton">Connect to MetaMask</button>
    <div id="accountInfo" style="display:none;">
        <h3>Account:</h3>
        <p id="account"></p>
        <button id="buyNFTButton">Buy NFT</button>
    </div>

    <script>
        // Check if MetaMask is installed
        if (typeof window.ethereum === 'undefined') {
            alert("MetaMask is not installed. Please install MetaMask to use this feature.");
        } else {
            // Connect to MetaMask
            const connectButton = document.getElementById("connectButton");
            const accountInfo = document.getElementById("accountInfo");
            const accountParagraph = document.getElementById("account");
            const buyNFTButton = document.getElementById("buyNFTButton");

            connectButton.addEventListener("click", async () => {
                try {
                    // Request account access
                    const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                    const userAccount = accounts[0];

                    // Display user account information
                    accountParagraph.textContent = userAccount;
                    accountInfo.style.display = "block";
                    connectButton.style.display = "none";
                } catch (error) {
                    console.error("User rejected the connection request or an error occurred.");
                }
            });

            // Buy NFT button click handler
            buyNFTButton.addEventListener("click", async () => {
                try {
                    // Set up the provider and signer
                    const provider = new ethers.BrowserProvider(window.ethereum);
                    const signer = provider.getSigner();

                    // Specify the contract address and ABI for the NFT contract
                    const nftContractAddress = "0xYourNFTContractAddress"; // Replace with actual NFT contract address
                    const nftAbi = [
                        "function buyNFT(uint256 tokenId) public payable"
                    ];

                    const contract = new ethers.Contract(nftContractAddress, nftAbi, signer);

                    // Define the token ID you want to buy and price (in Wei)
                    const tokenId = 1; // Example token ID
                    const price = ethers.parseUnits("0.1", "ether"); // Example price 0.1 ETH

                    // Call the buyNFT function
                    const tx = await contract.buyNFT(tokenId, {
                        value: price
                    });

                    // Wait for transaction to be mined
                    await tx.wait();
                    alert("NFT successfully purchased!");
                } catch (error) {
                    console.error("Error buying NFT:", error);
                    alert("Failed to purchase NFT.");
                }
            });
        }
    </script>
</body>
</html>
